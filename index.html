<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>로그인</title>
  <script src="/data.js"></script>
  <style>
    /* 폼 섹션 숨김/표시 */
.form-section {
  display: none;
}

.form-section.active {
  display: block;
}/* 전체 배경 스타일 변경 */
body {
  background: url('public/background.jpg') center center/cover no-repeat fixed;
  color: #333;
  font-family: 'Arial', sans-serif;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  margin: 0;
  padding: 0;
}

/* 로그인 컨테이너를 좌우 분할 레이아웃으로 변경 */
.login-container {
  background: white;
  border-radius: 15px;
  width: 1000px;
  height: 600px;
  display: flex;
  overflow: hidden;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
}

/* 왼쪽 이미지 영역 */
.left-section {
  flex: 1;
  background: url('public/login3d.jpg') center center/cover no-repeat;
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  align-items: center;
  color: white;
  position: relative;
  padding: 40px;
}

.left-section::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 45, 248, 0.377);
  pointer-events: none;
}

.left-content {
  text-align: center;
  position: relative;
  z-index: 1;
}

.left-content h2 {
  font-size: 30px;
  font-weight: bold;
  margin: 30px;
  font-weight: normal;
  line-height: 1.5;
}

/* 오른쪽 로그인 폼 영역 */
.right-section {
  flex: 1;
  padding: 40px 50px;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
}

/* 로고 스타일 수정 */
.logo {
  width: 240px;
  height: auto;
  margin: 0 0 40px 0;
  display: block;
}

.login-container h1 {
  display: none;
}

/* 탭 버튼 스타일 수정 */
.tab-buttons {
  display: flex;
  justify-content: flex-start;
  background-color: transparent;
  border-radius: 0;
  overflow: visible;
  margin-bottom: 30px;
  padding: 0;
  border-bottom: 1px solid #e0e0e0;
}

.tab-buttons button {
  flex: none;
  padding: 12px 20px;
  background: none;
  border: none;
  color: #999;
  cursor: pointer;
  font-size: 14px;
  border-radius: 0;
  transition: all 0.3s ease;
  border-bottom: 2px solid transparent;
  margin-right: 20px;
}

.tab-buttons button.active {
  background-color: transparent;
  color: #4c63d2;
  font-weight: bold;
  border-bottom: 2px solid #4c63d2;
}

/* 입력 필드 스타일 수정 */
input[type="text"], input[type="password"] {
  width: 100%;
  background: #f8f9fa;
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  padding: 15px;
  margin-bottom: 20px;
  color: #333;
  font-size: 14px;
  box-sizing: border-box;
}

input[type="text"]:focus, input[type="password"]:focus {
  outline: none;
  border: 1px solid #4c63d2;
  background: white;
}

input::placeholder {
  color: #999;
}

/* 로그인 버튼 스타일 수정 */
button.login-btn {
  width: 100%;
  background-color: #4c63d2;
  border: none;
  padding: 15px;
  border-radius: 8px;
  color: white;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s ease;
}

button.login-btn:hover {
  background-color: #3a4fb8;
  transform: translateY(-2px);
}

/* 에러 메시지 스타일 */
p#errorMessage, p#engineerError {
  color: #ff6b6b;
  font-size: 14px;
  margin-top: -10px;
  margin-bottom: 15px;
}

/* ✨ 모바일 반응형 설정을 위한 미디어 쿼리 시작! ✨ */
@media (max-width: 768px) { /* 화면 너비가 768px 이하일 때만 이 스타일을 적용할 거야! */

  body {
    /* 모바일에서는 높이가 너무 고정되면 안 되니까 auto로 유연하게 만들어주고, */
    /* 컨텐츠가 길어지면 스크롤 될 수 있도록 min-height를 줘! */
    height: auto;
    min-height: 100vh;
    /* 상하좌우로 여백 좀 줘서 답답하지 않게! */
    padding: 20px 20px;
    align-items: center; /* 컨테이너를 화면 상단으로 정렬 */
  }

  .login-container {
    flex-direction: column; /* 좌우가 아니라 위아래로 쌓이게 변경! */
    width: 100%; /* 모바일에서는 고정 1000px 말고 화면 너비에 맞춰 유연하게 90%로! */
    height: auto; /* 높이도 컨텐츠에 맞춰서 자동으로 늘어나게 해줘! */
    max-width: 500px; /* 너무 옆으로 늘어나지 않게 최대 너비 설정 (태블릿 가로 등) */
    margin: 20px auto; /* 가운데 정렬! */
  }

  /* 왼쪽 이미지 섹션이랑 오른쪽 로그인 폼 섹션을 모바일 버전에 맞게 조절! */
  .left-section,
  .right-section {
    flex: none; /* 이제 똑같은 비율로 나눌 필요 없으니까 flex를 초기화! */
    height: auto; /* 높이는 내용에 따라 자동으로! */
  }

  .left-section {
    padding: 30px 20px; /* 모바일에서 보기 좋게 안쪽 여백 조절 */
    min-height: 200px; /* 이미지 섹션이 너무 작아지지 않게 최소 높이 지정 */
    justify-content: center; /* 이미지 섹션 내부 내용도 가운데 정렬! */
  }

  .left-content h2 {
    font-size: 24px; /* 모바일에서는 글자 크기를 좀 줄여서 보기 좋게! */
    margin: 15px; /* 모바일에서 보기 좋게 여백도 조절! */
  }

  .right-section {
    padding: 30px 20px; /* 오른쪽 로그인 폼 여백도 조절! */
  }

  .logo-panel {
    display: flex;
    justify-content: center;
  }

  /* 혹시 로고 크기가 너무 크면 모바일에서 줄여줘도 좋아 */
  .logo {
    width: 120px;
    margin-bottom: 20px;
  }

  /* 탭 버튼들도 모바일에서 보기 좋게 조절할 수 있어 */
  .tab-buttons {
    justify-content: center; /* 탭 버튼도 가운데로! */
    margin-bottom: 20px;
  }

  .tab-buttons button {
    font-size: 13px;
    padding: 10px 15px;
  }

  /* 입력 필드랑 버튼들도 모바일에서 조금씩 조절하면 더 보기 좋아! */
  input[type="text"],
  input[type="password"] {
    padding: 12px;
    margin-bottom: 15px;
  }

  button.login-btn {
    padding: 12px;
    font-size: 15px;
  }
}
/* ✨ 모바일 반응형 설정을 위한 미디어 쿼리 끝! ✨ */

  </style>
</head>
<body>

<div class="login-container">
  <!-- 왼쪽 이미지 섹션 -->
  <div class="left-section">
    <div class="left-content">
      <h2>언제 어디서든,<br>MA ZIPSA와 함께</h2>
      <a href="https://www.mesa.kr/" target="_blank" style="color: rgb(255, 255, 255); text-decoration: none; font-size: 14px;">www.mesa.kr</a>
    </div>
  </div>
  
  <!-- 오른쪽 로그인 폼 섹션 -->
  <div class="right-section">
    <div class="logo-panel">
    <img src="public/logo_text.png" alt="MA ZIPSA 로고" class="logo">
    </div>
    <div class="tab-buttons">
      <button id="clientTab" class="active" onclick="switchTab('client')">고객사</button>
      <button id="engineerTab" onclick="switchTab('engineer')">엔지니어</button>
    </div>

  <!-- 고객사 로그인 -->
  <div id="clientForm" class="form-section active">
    <input type="text" id="clientId" placeholder="아이디" />
    <input type="password" id="clientPassword" placeholder="비밀번호" />
    <p id="errorMessage"></p>
    <button class="login-btn" onclick="loginClient()">로그인</button>
  </div>

  <!-- 엔지니어 로그인 -->
  <div id="engineerForm" class="form-section">
    <input type="text" id="engineerId" placeholder="아이디" />
    <input type="password" id="engineerPw" placeholder="비밀번호" />
    <p id="engineerError"></p>
    <button class="login-btn" onclick="loginEngineer()">로그인</button>
  </div>
</div>
</div>

<script>

  // 서버 주소 (백엔드 API Ping)
  const backendPingUrl = "https://ma-helper.onrender.com/api/test";

  // 페이지 로드 시 백엔드 서버 깨우기
  window.addEventListener("DOMContentLoaded", () => {
    fetch(backendPingUrl)
      .then(res => res.json())
      .then(data => {
        console.log("✅ 백엔드 서버 깨움:", data);
      })
      .catch(err => {
        console.warn("⚠️ 백엔드 깨우기 실패:", err);
      });
  });

  
  // 탭 전환
  function switchTab(type) {
    document.getElementById('clientForm').classList.toggle('active', type === 'client');
    document.getElementById('engineerForm').classList.toggle('active', type === 'engineer');
    document.getElementById('clientTab').classList.toggle('active', type === 'client');
    document.getElementById('engineerTab').classList.toggle('active', type === 'engineer');
  }

  async function loginClient() {
    const clientId = document.getElementById('clientId').value;
    const clientPassword = document.getElementById('clientPassword').value;
    try {
      const response = await fetch('https://ma-helper.onrender.com/api/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id: clientId, password: clientPassword })
      });
      if (response.ok) {
        const client = await response.json();
        localStorage.setItem('loggedClient', JSON.stringify(client));
        window.location.href = 'main.html';
      } else {
        document.getElementById('errorMessage').innerText = 'ID 또는 비밀번호가 잘못되었습니다.';
      }
    } catch (error) {
      console.error("로그인 오류:", error);
      document.getElementById('errorMessage').innerText = '서버 연결에 실패했습니다.';
    }
  }

  async function loginEngineer() {
  const id = document.getElementById('engineerId').value.trim();
  const pw = document.getElementById('engineerPw').value.trim();

  try {
    const response = await fetch('https://ma-helper.onrender.com/api/engineer-login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ id, password: pw })
    });

    if (response.ok) {
      const engineer = await response.json();
      localStorage.setItem('loggedEngineer', JSON.stringify(engineer));
      window.location.href = 'engineer.html';
    } else {
      document.getElementById('engineerError').innerText = 'ID 또는 비밀번호가 잘못되었습니다.';
    }

  } catch (error) {
    console.error("엔지니어 로그인 오류:", error);
    document.getElementById('engineerError').innerText = '서버 연결에 실패했습니다.';
  }
}

  // 엔터 키 로그인
  document.getElementById('clientPassword').addEventListener('keypress', function(event) {
    if (event.key === 'Enter') loginClient();
  });
  document.getElementById('engineerPw').addEventListener('keypress', function(event) {
    if (event.key === 'Enter') loginEngineer();
  });
</script>

</body>
</html>